# Docker 컨테이너는 가상 머신일까 프로세스일까?
## 개요
- 도커 컨테이너와 가상 머신이 어떻게 다른 것인가에 대한 질문에 어떻게 답할 것인가?
  - 가상 머신은 호스트 운영체제 위에 하드웨어를 에뮬레이션한 후 그 위에 운영체제를 올리고 프로세스를 실행하는 구조
  - 도커 컨테이너는 하드웨어 에뮬레이션 없이 리눅스 커널을 공유해 바로 프로세스를 실행하는 구조
- 그렇다면 도커 컨테이너는 프로세스일까? 에 대한 질문에는 어떻게 답할 수 있을까.

## 도커 컨테이너의 커널 사용
- 이에 대한 검증은 직접 컨테이너를 실행하고 컨테이너 안에서 uname -a 명령어를 실행함으로써 확인할 수 있다.

```bash
[root@m-k8s ~]# docker run -it ubuntu:latest bash
root@d292395e073e:/# uname -a
Linux d292395e073e 3.10.0-1127.19.1.el7.x86_64 #1 SMP Tue Aug 25 17:23:54 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
```
```bash
[root@m-k8s ~]# docker run -it centos:latest bash
[root@31fefd003b11 /]# uname -a
Linux 31fefd003b11 3.10.0-1127.19.1.el7.x86_64 #1 SMP Tue Aug 25 17:23:54 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
```

- 서로 다른 파일 시스템 (독립적)을 가지나 uname -a 출력 결과가 동일하다는 것을 확인할 수 있다.
  - 같은 커널을 공유하여 사용하고 있다.

```bash
[root@m-k8s ~]# uname -a
Linux m-k8s 3.10.0-1127.19.1.el7.x86_64 #1 SMP Tue Aug 25 17:23:54 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
```

- 위의 결과는 호스트의 커널이다. 호스트 네임만 빼고 같다는 것을 확인할 수 있다.
- 여기까지 알 수 있는 사실은 다음과 같다.
  - 컨테이너는 호스트 시스템의 커널을 사용한다.
  - 컨테이너는 이미지에 따라 파일 시스템이 달라진다.
 
## 도커의 프로세스 id

```bash
[root@m-k8s ~]# echo $$
22127
[root@m-k8s ~]# docker run -it centos:latest bash
[root@2376df7e1497 /]# echo $$
1
```

- 호스트 상에서 확인한 shell의 pid는 22127로 확인된다.
- 그러나, 컨테이너 내에서 확인한 shell의 pid는 1번이다.
  - 리눅스에서의 1번 프로세스는 init 프로세스로써 특별한 의미를 갖는다.
  - 모든 프로세스의 부모 프로세스로써 관리하고 제어하는 역할을 한다.
 
### 가능한 이유
- 이것이 가능한 이유는 이를 구현하는데 리눅스 PID 네임스페이스가 사용되었기 때문이다.
  - 좀 더 정확히 표현하자면, PID 네임스페이스가 분리되어 있기 때문에 도커 컨테이너의 프로세스는 1번 id를 갖는다.
  - unshare 명령어를 통해 PID 네임스페이스를 분리할 수 있다. (unshare 명령어는 특정 네임스페이스를 분리 가능)
- 도커 컨테이너 내에서 프로세스에게는 자신의 PID가 1번으로 보이지만, 호스트 입장에서는 PID가 2387인 일반적인 프로세스일 뿐이다.

















